import{a as i,A as R,p as b,o as e,z as C,w as D,y as M}from"./chunk-QMGIS6GS-IYNE5lo-.js";import{a as O,A as j}from"./APIManager-DjZ2JeQn.js";import{F as P,V as N,a as _,B as v,A as w,W as L,R as k,i as q,G as T,b as B}from"./FormLoadingBox-DPPTN9Qq.js";import{A as F}from"./AuthManager-ExnMPQVq.js";import{F as y,a as S,I as A}from"./FormLabel-pKFL5MWd.js";import{I as V}from"./IconButton-DTJ_elII.js";import{S as m,T as p}from"./Stack-BtWcuzwx.js";import{B as W}from"./Box-DYWOHMTh.js";import{L as E}from"./createSvgIcon-B5DNpR_6.js";import{S as I}from"./Small-B47FBGJb.js";import{C as G}from"./CircularProgress-DXBXuAGW.js";import{D as z}from"./LinearProgress-CQVqLp0U.js";import{g as K}from"./defaultMeta-DeBRnKiC.js";import"./styleUtils-DeGQejeq.js";import"./buttonClasses-WMzfpi3a.js";import"./useButton-N5pheNpA.js";import"./useIsFocusVisible-DWNmkbBi.js";import"./dividerClasses-CVaPNh8D.js";const U=()=>{const[r,l]=i.useState(!1),[c,n]=i.useState(!1),[s,a]=R(),f=b(),d=()=>[c].some(u=>u);return e.jsxs("form",{onSubmit:u=>{u.preventDefault();const h=u.currentTarget.elements;let g={username:h.username.value,password:h.password.value};n(!0),["error","errorMessage","errorCode"].forEach(o=>{s.has(o)&&s.delete(o)}),a(s),F.local.login(g.username,g.password).then(o=>{o?f("/dashboard"):(s.set("error","local"),a(s),n(!1))}).catch(o=>{o instanceof O&&o.status===400?(s.set("error","local"),s.set("errorMessage","invalid username and/or password :("),s.set("errorCode","ERR_LOCAL_INVALID_CREDENTIALS"),a(s)):(s.set("error","local"),a(s)),n(!1)})},style:{position:"relative"},children:[e.jsx(P,{show:d()}),e.jsxs(y,{required:!0,disabled:d(),children:[e.jsx(S,{children:"username"}),e.jsx(A,{type:"text",name:"username",autoComplete:"username"})]}),e.jsxs(y,{required:!0,sx:{mt:-1},disabled:d(),children:[e.jsx(S,{children:"password"}),e.jsx(A,{type:r?"text":"password",name:"password",autoComplete:"current-password",endDecorator:e.jsx(V,{onClick:()=>l(!r),children:r?e.jsx(N,{}):e.jsx(_,{})})})]}),e.jsxs(m,{sx:{gap:3,mt:1},children:[e.jsx(W,{sx:{display:"flex",justifyContent:"end",alignItems:"center"},children:e.jsx(C,{to:"/passwordreset",children:e.jsx(E,{level:"title-sm",component:"div",children:"forgot password?"})})}),e.jsx(v,{type:"submit",fullWidth:!0,disabled:d(),children:"sign in"})]})]})},$=()=>{const[r,l]=i.useState(),[c,n]=i.useState(void 0),[s,a]=i.useState(!0),[f,d]=i.useState(!1),[u,h]=i.useState(!0),g=()=>{j.auth.getLoginTypes().then(t=>{t?.length?l(t):n("noconfigset"),a(!1)}).catch(t=>{n(t),a(!1)}),j.auth.getAccountRegistrationOpen().then(t=>{t&&d(t)}).finally(()=>{h(!1)})},o=()=>{l(void 0),n(void 0),a(!0),d(!1),h(!0)};return i.useEffect(()=>{g()},[]),[s,u].some(t=>t)?e.jsx(m,{direction:"row",justifyContent:"center",children:e.jsx(G,{variant:"soft"})}):c?e.jsxs(m,{direction:"column",gap:4,children:[e.jsxs("div",{children:[e.jsx(w,{startDecorator:e.jsx(L,{}),variant:"outlined",color:"danger",children:e.jsxs("div",{children:["can't load login configuration",e.jsx(p,{level:"body-sm",component:"div",children:"i can't seem to load the login settings. please check your internet connection, or contact the owner of this instance of atom."})]})}),e.jsx(I,{sx:{mt:1},children:"ERR_NO_SERVER_LOGIN_CONFIGS"})]}),e.jsx(v,{size:"sm",color:"primary",startDecorator:e.jsx(k,{}),onClick:()=>{o(),g()},children:"retry"})]}):e.jsxs(m,{sx:{gap:4},children:[e.jsxs(m,{sx:{gap:1},children:[e.jsx(p,{component:"h1",level:"h3",children:"sign in"}),f?e.jsxs(p,{level:"body-sm",component:"div",children:["don't have an account?"," ",e.jsx(C,{to:"/signup",children:e.jsx(E,{component:"div",children:"request one here!"})})]}):null]}),q([...new Set(r)].map(t=>{switch(t){case"google":return e.jsx(x,{method:t,children:e.jsx(v,{variant:"soft",color:"neutral",fullWidth:!0,startDecorator:e.jsx(T,{}),onClick:()=>{document.location.href="/auth/login/google"},children:"login with google"},t)});case"local":return e.jsx(x,{method:t,children:e.jsx(U,{},t)});default:return e.jsx(x,{method:t,children:e.jsxs(w,{startDecorator:e.jsx(L,{}),color:"warning",variant:"outlined",children:["unsupported authentication method: ",t]},t)})}}),e.jsx(z,{children:"or"}))]})},x=({method:r,children:l})=>{const[c,n]=R();return e.jsxs(m,{gap:1,children:[l,c.get("error")==r?e.jsx(w,{startDecorator:e.jsx(B,{}),sx:{alignItems:"flex-start"},variant:"soft",color:"danger",children:e.jsxs("div",{children:[e.jsx("div",{children:"couldn't log in"}),e.jsx(p,{level:"body-sm",color:"danger",textTransform:"lowercase",children:c.get("errorMessage")||"something happened and i couldn't log you in"}),e.jsx(I,{textTransform:"uppercase",children:c.get("errorCode")||"ERR_UNKNOWN"})]})}):null]})};function he({}){return K("log in - atom")}async function ge(){return await j.auth.loggedIn()?M("/dashboard"):{}}const pe=D(function({loaderData:l}){return e.jsx($,{})});export{ge as clientLoader,pe as default,he as meta};
