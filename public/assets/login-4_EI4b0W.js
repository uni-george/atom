import{a as g,o as e,A as E,p as F,z as $,w as G,y as H}from"./chunk-QMGIS6GS-Cu-6P6Bw.js";import{a as J,c as K,b as Q,A as y}from"./APIManager-BmgSMlkF.js";import{F as R,a as _,I as S,V as X,b as Y,B as k,A as C,W as I,R as Z,i as ee,D as re,G as se,c as oe}from"./interleave-DeQMC6fJ.js";import{B as L}from"./Box-2c1FOgfs.js";import{g as ae,a as te,b as ne,c as ie,_ as v,e as le,s as ce,f as de,w as j,h as ge,S as x,j as P}from"./Stack-DhFApu8q.js";import{r as ue,S as W}from"./Small-BRu3RRzM.js";import{d as he,k as pe,I as me,L as A,C as ve}from"./createSvgIcon-DY0Mft1u.js";import{g as xe}from"./defaultMeta-DeBRnKiC.js";function fe(r){return ae("MuiLinearProgress",r)}te("MuiLinearProgress",["root","determinate","colorPrimary","colorNeutral","colorDanger","colorSuccess","colorWarning","colorContext","sizeSm","sizeMd","sizeLg","variantPlain","variantOutlined","variantSoft","variantSolid"]);const Le=["children","className","component","color","size","variant","thickness","determinate","value","style","slots","slotProps"];let D=r=>r,z,M;const Pe=pe(z||(z=D`
  0% {
    left: var(--_LinearProgress-progressInset);
    width: var(--LinearProgress-progressMinWidth);
  }

  25% {
    width: var(--LinearProgress-progressMaxWidth);
  }

  50% {
    left: var(--_LinearProgress-progressLeft);
    width: var(--LinearProgress-progressMinWidth);
  }

  75% {
    width: var(--LinearProgress-progressMaxWidth);
  }

  100% {
    left: var(--_LinearProgress-progressInset);
    width: var(--LinearProgress-progressMinWidth);
  }
`)),je=r=>{const{determinate:s,color:a,variant:o,size:t}=r,l={root:["root",s&&"determinate",a&&`color${j(a)}`,o&&`variant${j(o)}`,t&&`size${j(t)}`]};return ge(l,fe,{})},be=ce("div",{name:"JoyLinearProgress",slot:"Root",overridesResolver:(r,s)=>s.root})(({ownerState:r,theme:s})=>{var a,o,t,l;return v({"--LinearProgress-radius":"var(--LinearProgress-thickness)","--LinearProgress-progressThickness":"var(--LinearProgress-thickness)","--LinearProgress-progressRadius":"max(var(--LinearProgress-radius) - var(--_LinearProgress-padding), min(var(--_LinearProgress-padding) / 2, var(--LinearProgress-radius) / 2))"},r.size==="sm"&&{"--LinearProgress-thickness":"4px"},r.size==="md"&&{"--LinearProgress-thickness":"6px"},r.size==="lg"&&{"--LinearProgress-thickness":"8px"},r.thickness&&{"--LinearProgress-thickness":`${r.thickness}px`},!r.determinate&&{"--LinearProgress-progressMinWidth":"calc(var(--LinearProgress-percent) * 1% / 2)","--LinearProgress-progressMaxWidth":"calc(var(--LinearProgress-percent) * 1%)","--_LinearProgress-progressLeft":"calc(100% - var(--LinearProgress-progressMinWidth) - var(--_LinearProgress-progressInset))","--_LinearProgress-progressInset":"calc(var(--LinearProgress-thickness) / 2 - var(--LinearProgress-progressThickness) / 2)"},{minBlockSize:"var(--LinearProgress-thickness)",boxSizing:"border-box",borderRadius:"var(--LinearProgress-radius)",display:"flex",justifyContent:"center",alignItems:"center",flex:1,padding:"var(--_LinearProgress-padding)",position:"relative"},(a=s.variants[r.variant])==null?void 0:a[r.color],{"--_LinearProgress-padding":"max((var(--LinearProgress-thickness) - 2 * var(--variant-borderWidth, 0px) - var(--LinearProgress-progressThickness)) / 2, 0px)","&::before":{content:'""',display:"block",boxSizing:"inherit",blockSize:"var(--LinearProgress-progressThickness)",borderRadius:"var(--LinearProgress-progressRadius)",backgroundColor:"currentColor",color:"inherit",position:"absolute"}},r.variant==="soft"&&{backgroundColor:s.variants.soft.neutral.backgroundColor,color:(o=s.variants.solid)==null?void 0:o[r.color].backgroundColor},r.variant==="solid"&&{backgroundColor:(t=s.variants.softHover)==null?void 0:t[r.color].backgroundColor,color:(l=s.variants.solid)==null?void 0:l[r.color].backgroundColor})},({ownerState:r})=>r.determinate?{"&::before":{left:"var(--_LinearProgress-padding)",inlineSize:"calc(var(--LinearProgress-percent) * 1% - 2 * var(--_LinearProgress-padding))"}}:he(M||(M=D`
          &::before {
            animation: ${0}
              var(--LinearProgress-circulation, 2.5s ease-in-out 0s infinite normal none running);
          }
        `),Pe),({ownerState:r,theme:s})=>{const{borderRadius:a,height:o}=ue({theme:s,ownerState:r},["borderRadius","height"]);return v({},a!==void 0&&{"--LinearProgress-radius":a},o!==void 0&&{"--LinearProgress-thickness":o})}),ye=g.forwardRef(function(s,a){const o=ne({props:s,name:"JoyLinearProgress"}),{children:t,className:l,component:h,color:d="primary",size:i="md",variant:p="soft",thickness:m,determinate:c=!1,value:f=c?0:25,style:n,slots:N={},slotProps:O={}}=o,T=ie(o,Le),w=v({},o,{component:h,color:d,size:i,variant:p,thickness:m,value:f,determinate:c,instanceSize:s.size}),q=je(w),U=v({},T,{component:h,slots:N,slotProps:O}),[B,V]=le("root",{ref:a,className:de(q.root,l),elementType:be,externalForwardedProps:U,ownerState:w,additionalProps:v({as:h,role:"progressbar",style:v({},{"--LinearProgress-percent":f},n)},typeof f=="number"&&c&&{"aria-valuenow":Math.round(f)})});return e.jsx(B,v({},V,{children:t}))});class ke{static async login(s,a){return!!await u.request({method:"post",url:"/login/local",data:{username:s,password:a}})}}class u{static#e=void 0;static#r=!1;static local=ke;static init(){u.#e=J.create({baseURL:K.auth.location,allowAbsoluteUrls:!1,timeout:1e3,headers:{Accept:"application/json"}}),u.#r=!0}static async request(s){return u.#r||u.init(),await u.#e?.request(s)}}const Ce=()=>{const[r,s]=g.useState(!1),[a,o]=g.useState(!1),[t,l]=E(),h=F(),d=()=>[a].some(i=>i);return e.jsxs("form",{onSubmit:i=>{i.preventDefault();const p=i.currentTarget.elements,m={username:p.username.value,password:p.password.value};o(!0),["error","errorMessage","errorCode"].forEach(c=>{t.has(c)&&t.delete(c)}),l(t),u.local.login(m.username,m.password).then(c=>{c?(console.log("hellooooooooooo"),h("/dashboard")):(t.set("error","local"),l(t),o(!1))}).catch(c=>{c instanceof Q&&c.status===400?(t.set("error","local"),t.set("errorMessage","invalid username and/or password :("),t.set("errorCode","ERR_LOCAL_INVALID_CREDENTIALS"),l(t)):t.set("error","local"),o(!1)})},style:{position:"relative"},children:[e.jsx(L,{sx:i=>({position:"absolute",top:`-${i.radius.xl}`,left:`-${i.radius.xl}`,width:`calc(100% + (2 * ${i.radius.xl}))`,height:`calc(100% + (2 * ${i.radius.xl}))`,background:i.palette.background.surface,zIndex:1,opacity:d()?.8:0,borderRadius:i.radius.lg,pointerEvents:"none",transition:"opacity 0.2s"}),children:e.jsx(L,{sx:{width:"80%",mx:"auto",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(L,{sx:{width:"100%"},children:e.jsx(ye,{})})})}),e.jsxs(R,{required:!0,disabled:d(),children:[e.jsx(_,{children:"username"}),e.jsx(S,{type:"text",name:"username",autoComplete:"username"})]}),e.jsxs(R,{required:!0,sx:{mt:-1},disabled:d(),children:[e.jsx(_,{children:"password"}),e.jsx(S,{type:r?"text":"password",name:"password",autoComplete:"current-password",endDecorator:e.jsx(me,{onClick:()=>s(!r),children:r?e.jsx(X,{}):e.jsx(Y,{})})})]}),e.jsxs(x,{sx:{gap:3,mt:1},children:[e.jsx(L,{sx:{display:"flex",justifyContent:"end",alignItems:"center"},children:e.jsx($,{to:"/passwordreset",children:e.jsx(A,{level:"title-sm",component:"div",children:"forgot password?"})})}),e.jsx(k,{type:"submit",fullWidth:!0,disabled:d(),children:"sign in"})]})]})},we=()=>{const[r,s]=g.useState(),[a,o]=g.useState(void 0),[t,l]=g.useState(!0),[h,d]=g.useState(!1),[i,p]=g.useState(!0),m=()=>{y.auth.getLoginTypes().then(n=>{n?.length?s(n):o("noconfigset"),l(!1)}).catch(n=>{o(n),l(!1)}),y.auth.getAccountRegistrationOpen().then(n=>{n&&d(n)}).finally(()=>{p(!1)})},c=()=>{s(void 0),o(void 0),l(!0),d(!1),p(!0)};return g.useEffect(()=>{m()},[]),[t,i].some(n=>n)?e.jsx(x,{direction:"row",justifyContent:"center",children:e.jsx(ve,{variant:"soft"})}):a?e.jsxs(x,{direction:"column",gap:4,children:[e.jsxs("div",{children:[e.jsx(C,{startDecorator:e.jsx(I,{}),variant:"outlined",color:"danger",children:e.jsxs("div",{children:["can't load login configuration",e.jsx(P,{level:"body-sm",component:"div",children:"i can't seem to load the login settings. please check your internet connection, or contact the owner of this instance of atom."})]})}),e.jsx(W,{sx:{mt:1},children:"ERR_NO_SERVER_LOGIN_CONFIGS"})]}),e.jsx(k,{size:"sm",color:"primary",startDecorator:e.jsx(Z,{}),onClick:()=>{c(),m()},children:"retry"})]}):e.jsxs(x,{sx:{gap:4},children:[e.jsxs(x,{sx:{gap:1},children:[e.jsx(P,{component:"h1",level:"h3",children:"sign in"}),h?e.jsxs(P,{level:"body-sm",component:"div",children:["don't have an account?"," ",e.jsx($,{to:"/signup",children:e.jsx(A,{component:"div",children:"request one here!"})})]}):null]}),ee([...new Set(r)].map(n=>{switch(n){case"google":return e.jsx(b,{method:n,children:e.jsx(k,{variant:"soft",color:"neutral",fullWidth:!0,startDecorator:e.jsx(se,{}),onClick:()=>{document.location.href="/auth/login/google"},children:"login with google"},n)});case"local":return e.jsx(b,{method:n,children:e.jsx(Ce,{},n)});default:return e.jsx(b,{method:n,children:e.jsxs(C,{startDecorator:e.jsx(I,{}),color:"warning",variant:"outlined",children:["unsupported authentication method: ",n]},n)})}}),e.jsx(re,{children:"or"}))]})},b=({method:r,children:s})=>{const[a,o]=E();return e.jsxs(x,{gap:1,children:[s,a.get("error")==r?e.jsx(C,{startDecorator:e.jsx(oe,{}),sx:{alignItems:"flex-start"},variant:"soft",color:"danger",children:e.jsxs("div",{children:[e.jsx("div",{children:"couldn't log in"}),e.jsx(P,{level:"body-sm",color:"danger",textTransform:"lowercase",children:a.get("errorMessage")||"something happened and i couldn't log you in"}),e.jsx(W,{textTransform:"uppercase",children:a.get("errorCode")||"ERR_UNKNOWN"})]})}):null]})};function We({}){return xe("log in - atom")}async function Ae(){return await y.auth.loggedIn()?H("/dashboard"):{}}const De=G(function({loaderData:s}){return e.jsx(we,{})});export{Ae as clientLoader,De as default,We as meta};
