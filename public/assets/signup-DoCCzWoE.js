import{a as c,o as e,A as H,p as A,z as M,w as D,y as N}from"./chunk-QMGIS6GS-IYNE5lo-.js";import{a as U,A as L}from"./APIManager-mj48QvlX.js";import{E as $}from"./ErrorCard-uTo-NOV5.js";import{F as k,V as O,a as V,R as W,i as z,A as P,W as G,G as B,b as q}from"./FormLoadingBox-BtiFWQJk.js";import{A as g}from"./AuthManager-cdHuQ4gj.js";import{v as j}from"./index-CQLsfHBl.js";import{b as J,f as K,c as Q,F as S,a as y,I as C}from"./FormLabel-BT3Howjh.js";import{a as X,g as Y,u as Z,_ as ee,i as re,b as R,c as te,s as oe,e as se,S as x,T as f}from"./Stack-0SagYPpj.js";import{I as ae,C as ne}from"./IconButton-DJKRrB5i.js";import{B as w}from"./Button-GOJIU-XF.js";import{S as le}from"./Small-CV7M4cjO.js";import{L as ie}from"./Link-DyUlHCZS.js";import{D as ce}from"./LinearProgress-DxqFVR98.js";import{g as de}from"./defaultMeta-DeBRnKiC.js";import"./createSvgIcon-7-XOZzJM.js";import"./emotion-react.browser.esm-BU03tsFD.js";import"./buttonClasses-CBrHsLQP.js";import"./dividerClasses-twSQpa5f.js";function me(o){return Y("MuiFormHelperText",o)}const T=X("MuiFormHelperText",["root"]),ue=["children","component","slots","slotProps"],pe=()=>se({root:["root"]},me,{}),he=oe("div",{name:"JoyFormHelperText",slot:"Root",overridesResolver:(o,l)=>l.root})(({theme:o})=>({"--Icon-fontSize":"calc(var(--FormHelperText-lineHeight) * 1em)",display:"flex",alignItems:"center",gap:"2px",fontFamily:o.vars.fontFamily.body,fontSize:`var(--FormHelperText-fontSize, ${o.vars.fontSize.sm})`,lineHeight:`var(--FormHelperText-lineHeight, ${o.vars.lineHeight.sm})`,color:`var(--FormHelperText-color, ${o.vars.palette.text.tertiary})`,margin:"var(--FormHelperText-margin, 0px)",[`.${Q.root} + &`]:{"--FormHelperText-margin":"0px"},[`.${K.error} &`]:{"--Icon-color":"currentColor"}})),F=c.forwardRef(function(l,i){const a=Z({props:l,name:"JoyFormHelperText"}),{children:r,component:n,slots:u={},slotProps:p={}}=a,m=ee(a,ue),t=c.useRef(null),d=re(t,i),s=c.useContext(J),h=s?.setHelperText;c.useEffect(()=>(h?.(t.current),()=>{h?.(null)}),[h]);const E=pe(),I=R({},m,{component:n,slots:u,slotProps:p}),[b,_]=te("root",{ref:d,elementType:he,externalForwardedProps:I,ownerState:a,additionalProps:{as:n,id:s?.["aria-describedby"]},className:E.root});return e.jsx(b,R({},_,{children:r}))}),ge=()=>{const[o,l]=c.useState(!1),[i,a]=c.useState(!1),[r,n]=H(),u=A(),p=()=>[i].some(m=>m);return e.jsxs("form",{onSubmit:m=>{m.preventDefault();const t=m.currentTarget.elements,d={username:t.username.value,password:t.password.value};if(a(!0),["error","errorMessage","errorCode"].forEach(s=>{r.has(s)&&r.delete(s)}),n(r),d.username=j.trim(d.username),!j.matches(d.username,g.local.usernamePattern)){r.set("error","local"),r.set("errorMessage","invalid username - please only between 3 and 16 alphanumeric and the following characters: ._-"),r.set("errorCode","ERR_INVALID_USERNAME"),n(r),a(!1);return}if(!j.matches(d.password,g.local.passwordPattern)){r.set("error","local"),r.set("errorMessage",'invalid password - please only use between 12 and 255 alphanumeric and the following characters: ._+-/\\*=!"Â£$ %^&*()[]{}:;@#~&<>?'),r.set("errorCode","ERR_INVALID_PASSWORD"),n(r),a(!1);return}g.local.signup(d.username,d.password).then(s=>{s&&u("/dashboard")}).catch(s=>{s instanceof U&&s.status==400?(r.set("error","local"),r.set("errorMessage",s.response?.data?.message||"invalid username and/or password. "),r.set("errorCode",s.response?.data?.errorCode||"ERR_LOCAL_INVALID_SIGNUP_CREDENTIALS"),n(r)):(r.set("error","local"),n(r))}).finally(()=>{a(!1)})},style:{position:"relative"},children:[e.jsx(k,{show:p()}),e.jsxs(S,{required:!0,sx:{":focus-within":{[`& .${T.root}`]:{maxHeight:"100px",mt:1}}},children:[e.jsx(y,{children:"username"}),e.jsx(C,{type:"text",name:"username",autoComplete:"username"}),e.jsxs(F,{sx:{maxHeight:0,transition:"all 0.1s",overflow:"hidden",mt:0},children:["must match: ",g.local.usernamePattern.toString()]})]}),e.jsxs(S,{required:!0,sx:{mt:-1,":focus-within":{[`& .${T.root}`]:{maxHeight:"100px",mt:1}}},children:[e.jsx(y,{children:"password"}),e.jsx(C,{type:o?"text":"password",name:"password",autoComplete:"new-password",endDecorator:e.jsx(ae,{onClick:()=>l(!o),children:o?e.jsx(O,{}):e.jsx(V,{})})}),e.jsxs(F,{sx:{maxHeight:0,transition:"all 0.1s",overflow:"hidden",mt:0},children:["must match: ",e.jsx("br",{})," ",g.local.passwordPattern.toString()]})]}),e.jsx(w,{type:"submit",fullWidth:!0,sx:{mt:2},children:"sign up"})]})},xe=()=>{const[o,l]=c.useState(),[i,a]=c.useState(void 0),[r,n]=c.useState(!0),u=()=>{L.auth.getSignupTypes().then(t=>{t?.length?l(t):a("ERR_NO_SERVER_LOGIN_CONFIGS"),n(!1)}).catch(t=>{a(t),n(!1)})},p=()=>{l(void 0),a(void 0),n(!0)};return c.useEffect(()=>{u()},[]),[r].some(t=>t)?e.jsx(x,{direction:"row",justifyContent:"center",children:e.jsx(ne,{variant:"soft"})}):i?e.jsxs(x,{gap:4,children:[e.jsx($,{code:i,children:e.jsx(f,{level:"body-md",children:"either i can't load the authentication methods, or there are none set up. please check your connection, then contact the owner of this instance of atom."})}),e.jsx(w,{size:"sm",color:"primary",startDecorator:e.jsx(W,{}),onClick:()=>{p(),u()},children:"retry"})]}):e.jsxs(x,{gap:4,children:[e.jsxs(x,{gap:1,children:[e.jsx(f,{component:"h1",level:"h3",children:"sign up"}),e.jsxs(f,{level:"body-sm",component:"div",children:["already have an account?"," ",e.jsx(M,{to:"/login",children:e.jsx(ie,{component:"div",children:"login here!"})})]})]}),z([...new Set(o)].map(t=>{switch(t){case"google":return e.jsx(v,{method:t,children:e.jsx(w,{variant:"soft",color:"neutral",fullWidth:!0,startDecorator:e.jsx(B,{}),onClick:()=>{document.location.href="/auth/signup/google"},children:"sign up with google"},t)});case"local":return e.jsx(v,{method:t,children:e.jsx(ge,{})});default:return e.jsx(v,{method:t,children:e.jsxs(P,{startDecorator:e.jsx(G,{}),color:"warning",variant:"outlined",children:["unsupported authentication method: ",t]},t)})}}),e.jsx(ce,{children:"or"}))]})},v=({method:o,children:l})=>{const[i,a]=H();return e.jsxs(x,{gap:1,children:[l,i.get("error")==o?e.jsx(P,{startDecorator:e.jsx(q,{}),sx:{alignItems:"flex-start"},variant:"soft",color:"danger",children:e.jsxs("div",{children:[e.jsx("div",{children:"couldn't sign up"}),e.jsx(f,{level:"body-sm",color:"danger",textTransform:"lowercase",children:i.get("errorMessage")||"something happened and i couldn't sign you up"}),e.jsx(le,{textTransform:"uppercase",children:i.get("errorCode")||"ERR_UNKNOWN"})]})}):null]})};function Me({}){return de("sign up - atom")}async function De(){return await L.auth.loggedIn()?N("/dashboard"):{}}const Ne=D(function({loaderData:l}){return e.jsx(xe,{})});export{De as clientLoader,Ne as default,Me as meta};
