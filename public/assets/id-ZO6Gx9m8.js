import{a as r,o as e,p as he,w as Ie}from"./chunk-QMGIS6GS-DtoyICqO.js";import{g as Me}from"./defaultMeta-DeBRnKiC.js";import{D as H,s as De}from"./setDashboardNavigationContext-BWyQ02lE.js";import{G as Ae,D as Pe}from"./GlobalPermissionCheck-D0CbPT0Q.js";import{T as Te,a as $e,t as le,b as Ee,c as Z,d as Q}from"./Tabs-CmLFQxMt.js";import{g as Ue,c as E,S as fe,C as q,a as _e,E as Ne}from"./ErrorCard-KNXIau_K.js";import{A as P,G as B}from"./APIManager-B2UZ4w5a.js";import{A as J,S as ze}from"./AuthGuardUserContext-ClQQ3lGo.js";import{c as Be,S as He,P as Le}from"./Paginator-B2yTVwJH.js";import{n as ce}from"./noResultsKaomoji-CX4veuCQ.js";import{G as re}from"./Grid-NaLWcyrm.js";import{m as Fe,C as Ge,M as We,a as Ve,b as ve,c as ge,D as Ce,d as je,e as qe}from"./ModalDialog-B0YEj2t1.js";import{p as Je,g as be,a as ye,u as ae,b as L,s as K,f as A,h as ne,c as Ke,S as I,T as b,B as D}from"./Stack-JCjNLC7t.js";import{a as Xe,S as Ye,C as ie,L as Ze}from"./Link-B5kWyCnV.js";import{c as Qe}from"./createSvgIcon-D815fwpB.js";import{D as k,L as et}from"./LinearProgress-BtLiBgIz.js";import{F as U,a as z,I as X}from"./FormLabel-C-0_FOk2.js";import{S as tt,a as N}from"./Select-DBRM7IsL.js";import{B as _}from"./Button-31T2a4ki.js";import{b as de}from"./buttonClasses-Cy5i3mdA.js";import{c as Y}from"./createSvgIcon-DQe4S7v3.js";import{A as ot}from"./Avatar-C_jncssy.js";import{F}from"./FormHelperText-zgYa2BNp.js";import{C as st}from"./CardActions-D6HWY4Rd.js";import"./SelfPermissionCacheContext-DOzmS9ty.js";import"./ListItemButton-C-bDkTqT.js";import"./Small-BFUFtg_I.js";import"./useControlled-C68gA3PY.js";import"./Popper-DEf3PWv7.js";import"./index-Cwr4DWDF.js";import"./ownerWindow-nKC3jW2g.js";import"./useEventCallback-6_SerCR8.js";import"./dividerClasses-BlvlTBdT.js";const rt=Je();function at(t){return be("MuiAspectRatio",t)}ye("MuiAspectRatio",["root","content","colorPrimary","colorNeutral","colorDanger","colorSuccess","colorWarning","colorContext","variantPlain","variantOutlined","variantSoft","variantSolid"]);const nt=t=>{const{variant:o,color:s}=t,a={root:["root"],content:["content",o&&`variant${A(o)}`,s&&`color${A(s)}`]};return ne(a,at,{})},it=K("div",{name:"JoyAspectRatio",slot:"Root",overridesResolver:(t,o)=>o.root})(({ownerState:t,theme:o})=>{const s=typeof t.minHeight=="number"?`${t.minHeight}px`:t.minHeight,a=typeof t.maxHeight=="number"?`${t.maxHeight}px`:t.maxHeight;return{"--AspectRatio-paddingBottom":`clamp(var(--AspectRatio-minHeight), calc(100% / (${t.ratio})), var(--AspectRatio-maxHeight))`,"--AspectRatio-maxHeight":a||"9999px","--AspectRatio-minHeight":s||"0px","--Icon-color":t.color!=="neutral"||t.variant==="solid"?"currentColor":o.vars.palette.text.icon,borderRadius:"var(--AspectRatio-radius)",display:t.flex?"flex":"block",flex:t.flex?1:"initial",flexDirection:"column",margin:"var(--AspectRatio-margin)"}}),lt=K("div",{name:"JoyAspectRatio",slot:"Content",overridesResolver:(t,o)=>o.content})(({theme:t,ownerState:o})=>({flex:1,position:"relative",borderRadius:"inherit",height:0,paddingBottom:"calc(var(--AspectRatio-paddingBottom) - 2 * var(--variant-borderWidth, 0px))",overflow:"hidden",transition:"inherit","& [data-first-child]":{display:"flex",justifyContent:"center",alignItems:"center",boxSizing:"border-box",position:"absolute",width:"100%",height:"100%",objectFit:o.objectFit,margin:0,padding:0,"& > img":{width:"100%",height:"100%",objectFit:o.objectFit}},...t.typography["body-md"],...t.variants[o.variant]?.[o.color]})),ct=r.forwardRef(function(o,s){const a=ae({props:o,name:"JoyAspectRatio"}),{children:n,ratio:i="16 / 9",minHeight:d,maxHeight:l,objectFit:f="cover",color:u="neutral",variant:v="soft",component:c,flex:m=!1,slots:p={},slotProps:h={},...x}=a,w={...a,flex:m,minHeight:d,maxHeight:l,objectFit:f,ratio:i,color:u,variant:v},g=nt(w),R={...x,component:c,slots:p,slotProps:h},[S,y]=L("root",{ref:s,className:g.root,elementType:it,externalForwardedProps:R,ownerState:w}),[O,M]=L("content",{className:g.content,elementType:lt,externalForwardedProps:R,ownerState:w});return e.jsx(S,{...y,children:e.jsx(O,{...M,children:r.Children.map(n,(C,T)=>T===0&&r.isValidElement(C)?r.cloneElement(C,{"data-first-child":""}):C)})})}),dt=Qe(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),ut=t=>{const{variant:o,color:s}=t,a={root:["root",o&&`variant${A(o)}`,s&&`color${A(s)}`]};return ne(a,Ue,{})},mt=K("div",{name:"JoyCardOverflow",slot:"Root",overridesResolver:(t,o)=>o.root})(({theme:t,ownerState:o})=>{const s="calc(var(--CardOverflow-radius) - var(--variant-borderWidth, 0px))";return{alignSelf:"stretch",position:"relative",display:"flex",flexDirection:"var(--_CardOverflow-flexDirection)",margin:"var(--_CardOverflow-margin)",borderRadius:"var(--_CardOverflow-radius)",padding:"var(--_CardOverflow-padding)",[`.${E.vertical} &, .${E.horizontal} .${E.vertical} &, .${Fe.root} &`]:{"--_CardOverflow-flexDirection":"column","--AspectRatio-margin":"0 calc(-1 * var(--Card-padding))","--_CardOverflow-margin":"0 var(--CardOverflow-offset)","--_CardOverflow-padding":"0 var(--Card-padding)","&[data-first-child]":{"--AspectRatio-radius":`${s} ${s} 0 0`,"--_CardOverflow-radius":"var(--CardOverflow-radius) var(--CardOverflow-radius) 0 0","--_CardOverflow-margin":"var(--CardOverflow-offset) var(--CardOverflow-offset) 0"},"&[data-last-child]":{"--AspectRatio-radius":`0 0 ${s} ${s}`,"--_CardOverflow-radius":"0 0 var(--CardOverflow-radius) var(--CardOverflow-radius)","--_CardOverflow-margin":"0 var(--CardOverflow-offset) var(--CardOverflow-offset)"},"&[data-last-child][data-first-child]":{"--AspectRatio-radius":s,"--_CardOverflow-margin":"var(--CardOverflow-offset)"},[`& > .${de.root}:only-child`]:{zIndex:1,width:"calc(100% + -2 * var(--CardOverflow-offset))","--Button-margin":"0 var(--CardOverflow-offset)","--Button-radius":"0 0 var(--CardOverflow-radius) var(--CardOverflow-radius)"}},[`.${E.horizontal} &, .${E.vertical} .${E.horizontal} &`]:{"--_CardOverflow-flexDirection":"row","--AspectRatio-margin":"calc(-1 * var(--Card-padding)) 0px","--_CardOverflow-margin":"var(--CardOverflow-offset) 0px","--_CardOverflow-padding":"var(--Card-padding) 0px","&[data-first-child]":{"--AspectRatio-radius":`${s} 0 0 ${s}`,"--_CardOverflow-radius":"var(--CardOverflow-radius) 0 0 var(--CardOverflow-radius)","--_CardOverflow-margin":"var(--CardOverflow-offset) 0px var(--CardOverflow-offset) var(--CardOverflow-offset)"},"&[data-last-child]":{"--AspectRatio-radius":`0 ${s} ${s} 0`,"--_CardOverflow-radius":"0 var(--CardOverflow-radius) var(--CardOverflow-radius) 0","--_CardOverflow-margin":"var(--CardOverflow-offset) var(--CardOverflow-offset) var(--CardOverflow-offset) 0px"},"&[data-last-child][data-first-child]":{"--AspectRatio-radius":s,"--_CardOverflow-margin":"var(--CardOverflow-offset)"},[`& > .${de.root}:only-child`]:{height:"calc(100% + -2 * var(--CardOverflow-offset))","--Button-margin":"var(--CardOverflow-offset) 0","--Button-radius":"0 var(--CardOverflow-radius) var(--CardOverflow-radius) 0"}},...t.variants[o.variant]?.[o.color]}}),we=r.forwardRef(function(o,s){const a=ae({props:o,name:"JoyCardOverflow"}),{className:n,component:i="div",children:d,color:l="neutral",variant:f="plain",slots:u={},slotProps:v={},...c}=a,m={...a,component:i,color:l,variant:f},p=ut(m),h={...c,component:i,slots:u,slotProps:v},[x,w]=L("root",{ref:s,className:Ke(p.root,n),elementType:mt,externalForwardedProps:h,ownerState:m});return e.jsx(x,{...w,children:d})});we.muiName="CardOverflow";function xt(t){return be("MuiModalClose",t)}ye("MuiModalClose",["root","colorPrimary","colorNeutral","colorDanger","colorSuccess","colorWarning","colorContext","variantPlain","variantOutlined","variantSoft","variantSolid","sizeSm","sizeMd","sizeLg"]);var ue;const pt=t=>{const{variant:o,color:s,disabled:a,focusVisible:n,size:i}=t,d={root:["root",a&&"disabled",n&&"focusVisible",o&&`variant${A(o)}`,s&&`color${A(s)}`,i&&`size${A(i)}`]};return ne(d,xt,{})},ht=K(Ye,{name:"JoyModalClose",slot:"Root",overridesResolver:(t,o)=>o.root})(({ownerState:t,theme:o})=>({...t.size==="sm"&&{"--IconButton-size":"1.75rem"},...t.size==="md"&&{"--IconButton-size":"2rem"},...t.size==="lg"&&{"--IconButton-size":"2.25rem"},position:"absolute",zIndex:1,top:"var(--ModalClose-inset, 0.625rem)",right:"var(--ModalClose-inset, 0.625rem)",borderRadius:`var(--ModalClose-radius, ${o.vars.radius.sm})`,...!o.variants[t.variant]?.[t.color]?.backgroundColor&&{color:o.vars.palette.text.secondary}})),ft={plain:"plain",outlined:"plain",soft:"soft",solid:"solid"},Re=r.forwardRef(function(o,s){const a=ae({props:o,name:"JoyModalClose"}),{component:n="button",color:i="neutral",variant:d="plain",size:l="md",onClick:f,slots:u={},slotProps:v={},...c}=a,m=r.useContext(Ge),p=r.useContext(We),h=o.variant??ft[p?.variant]??d,x=o.color??p?.color??i,w=r.useContext(Ve),g=o.size??w??l,{focusVisible:R,getRootProps:S}=Xe({...a,rootRef:s}),y={...a,color:x,component:n,variant:h,size:g,focusVisible:R},O=pt(y),[M,C]=L("root",{ref:s,elementType:ht,getSlotProps:S,externalForwardedProps:{onClick:T=>{m?.(T,"closeClick"),f?.(T)},...c,component:n,slots:u,slotProps:v},className:O.root,ownerState:y});return e.jsx(M,{...C,children:ue||(ue=e.jsx(dt,{}))})}),vt=Y(e.jsx("path",{d:"M19 11H7.83l4.88-4.88c.39-.39.39-1.03 0-1.42a.996.996 0 0 0-1.41 0l-6.59 6.59c-.39.39-.39 1.02 0 1.41l6.59 6.59c.39.39 1.02.39 1.41 0s.39-1.02 0-1.41L7.83 13H19c.55 0 1-.45 1-1s-.45-1-1-1"})),me=Y(e.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zm3.17-6.41a.996.996 0 0 1 0-1.41c.39-.39 1.02-.39 1.41 0L12 12.59l1.41-1.41c.39-.39 1.02-.39 1.41 0s.39 1.02 0 1.41L13.41 14l1.41 1.41c.39.39.39 1.02 0 1.41s-1.02.39-1.41 0L12 15.41l-1.41 1.41c-.39.39-1.02.39-1.41 0a.996.996 0 0 1 0-1.41L10.59 14zM18 4h-2.5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1"})),gt=Y(e.jsx("path",{d:"M3 17.46v3.04c0 .28.22.5.5.5h3.04c.13 0 .26-.05.35-.15L17.81 9.94l-3.75-3.75L3.15 17.1q-.15.15-.15.36M20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"})),Ct=Y(e.jsx("path",{d:"M11 7h2v2h-2zm1 10c.55 0 1-.45 1-1v-4c0-.55-.45-1-1-1s-1 .45-1 1v4c0 .55.45 1 1 1m0-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"})),jt=({children:t,tabListContent:o,...s})=>e.jsxs(Te,{...s,sx:{bgcolor:"transparent",[`& .${Ee.root}`]:{p:0}},children:[e.jsx($e,{tabFlex:1,size:"sm",sx:{pl:{xs:0,md:4},position:"sticky",top:"-24px",pt:1,bgcolor:"background.body",justifyContent:"left",[`& .${le.root}`]:{fontWeight:"600",flex:"initial",color:"text.tertiary",borderRadius:"6px 6px 0 0",[`&.${le.selected}`]:{bgcolor:"transparent",color:"text.primary","&::after":{height:"2px",bgcolor:"primary.500"}}}},children:o}),t]}),ee=0,te=1,G=2,W=3,V=4,bt=5,Se=6,yt=["preEnter","entering","entered","preExit","exiting","exited","unmounted"],Oe=t=>({_s:t,status:yt[t],isEnter:t<W,isMounted:t!==Se,isResolved:t===G||t>V}),oe=t=>t?Se:bt,wt=(t,o)=>{switch(t){case te:case ee:return G;case V:case W:return oe(o)}},Rt=t=>typeof t=="object"?[t.enter,t.exit]:[t,t],St=(t,o)=>setTimeout(()=>{isNaN(document.body.offsetTop)||t(o+1)},0),xe=(t,o,s,a,n)=>{clearTimeout(a.current);const i=Oe(t);o(i),s.current=i,n&&n({current:i})},Ot=({enter:t=!0,exit:o=!0,preEnter:s,preExit:a,timeout:n,initialEntered:i,mountOnEnter:d,unmountOnExit:l,onStateChange:f}={})=>{const[u,v]=r.useState(()=>Oe(i?G:oe(d))),c=r.useRef(u),m=r.useRef(),[p,h]=Rt(n),x=r.useCallback(()=>{const g=wt(c.current._s,l);g&&xe(g,v,c,m,f)},[f,l]),w=r.useCallback(g=>{const R=y=>{switch(xe(y,v,c,m,f),y){case te:p>=0&&(m.current=setTimeout(x,p));break;case V:h>=0&&(m.current=setTimeout(x,h));break;case ee:case W:m.current=St(R,y);break}},S=c.current.isEnter;typeof g!="boolean"&&(g=!S),g?!S&&R(t?s?ee:te:G):S&&R(o?a?W:V:oe(l))},[x,f,t,o,s,a,p,h,l]);return[u,w,x]},se=({size:t=12,children:o})=>e.jsx(re,{sx:[a=>typeof t=="number"||t==null?{"--Column-width":t}:Array.isArray(t)?null:{"--Column-width":t.xs||12,[a.breakpoints.up("sm")]:{"--Column-width":t.sm||t.xs||12},[a.breakpoints.up("md")]:{"--Column-width":t.md||t.sm||t.xs||12},[a.breakpoints.up("lg")]:{"--Column-width":t.lg||t.md||t.sm||t.xs||12},[a.breakpoints.up("xl")]:{"--Column-width":t.xl||t.lg||t.md||t.sm||t.xs||12}},{width:"calc((100% - (((var(--Grid-columns) / var(--Column-width)) - 1) * var(--Grid-parent-columnSpacing))) * (var(--Column-width) / var(--Grid-columns)))"}],children:o}),kt=({open:t,onClose:o,image:s,setImage:a,...n})=>{const[i,d]=r.useState(!0),[l,f]=Ot({timeout:200,preEnter:!0}),[u,v]=r.useState([]),[c,m]=r.useState(0),[p,h]=r.useState(1),[x,w]=r.useState(0),[g,R]=r.useState(""),[S,y]=r.useState(s),[O,M]=r.useState(10),C=r.useRef(null),T=Be(async()=>{d(!0),w(Math.floor(Math.random()*ce.length));let j={name:g||void 0,offset:O*(p-1),limit:O,internal:!!g},$=await P.image.search(j);v($||[]);let ke=await P.image.count(j);m(ke||0),d(!1)},500,{leading:!1});return r.useEffect(()=>{T()},[g,O,p]),r.useEffect(()=>{f(t)},[t]),e.jsx(ve,{ref:C,keepMounted:!0,open:!["exited","exiting"].includes(l.status),onClose:o,sx:[l.status==="exited"?{visibility:"hidden"}:{visibility:"visible"}],slotProps:{backdrop:{sx:{opacity:0,backdropFilter:"none",transition:"opacity 200ms, backdrop-filter 200ms",...l.status=="entered"||l.status=="entering"?{opacity:1,backdropFilter:"blur(8px)"}:{}}}},...n,children:e.jsxs(ge,{layout:"center",variant:"outlined",sx:{opacity:0,transition:"opacity 300ms",...l.status=="entered"||l.status=="entering"?{opacity:1}:{},width:{xs:"100%",md:"calc(100% - 32px)"},height:{xs:"100%",md:"calc(100% - 32px)"},maxWidth:{md:1300},maxHeight:{md:800},display:"flex"},children:[e.jsx(Re,{}),e.jsx(Ce,{children:"choose image"}),e.jsx(k,{}),e.jsxs(I,{direction:"row",sx:{flexWrap:"wrap"},gap:2,children:[e.jsxs(U,{size:"sm",children:[e.jsx(z,{children:"image name"}),e.jsx(X,{size:"sm",placeholder:"search",value:g,onChange:j=>{R(j.target.value)},startDecorator:e.jsx(He,{})})]}),e.jsxs(U,{size:"sm",children:[e.jsx(z,{children:"images per page"}),e.jsxs(tt,{size:"sm",slotProps:{button:{sx:{whiteSpace:"nowrap"}}},value:O,onChange:(j,$)=>{M($||10)},children:[e.jsx(N,{value:5,children:"5"}),e.jsx(N,{value:10,children:"10"}),e.jsx(N,{value:15,children:"15"}),e.jsx(N,{value:20,children:"20"}),e.jsx(N,{value:25,children:"25"})]})]})]}),e.jsx(je,{children:i?e.jsx(I,{justifyContent:"center",alignItems:"center",height:1,children:e.jsx(ie,{})}):e.jsx(fe,{variant:"outlined",sx:j=>({overflow:"hidden",overflowY:"auto",bgcolor:"background.surface",height:1,p:2,borderRadius:j.radius.md,"--sb-track-color":"transparent","--sb-border-color":"var(--atom-palette-background-surface)"}),children:e.jsx(re,{spacing:1,container:!0,columns:12,children:u.length?u.map((j,$)=>e.jsx(se,{size:{xs:12,sm:6,md:4,lg:3},children:e.jsx(It,{image:j,tabIndex:$+1,onClick:()=>{y(j.id)},selected:S==j.id})},`${j.id}-${$}`)):e.jsx(se,{size:12,children:e.jsxs(I,{sx:{p:3,w:1},children:[e.jsx(b,{sx:{textAlign:"center",mb:2},level:"h3",textColor:"text.tertiary",component:"code",children:ce[x]}),e.jsx(b,{sx:{textAlign:"center"},level:"body-md",textColor:"text.tertiary",children:"no images"})]})})})})}),Math.ceil(c/O)>1&&e.jsx(Le,{page:p,setPage:h,numPages:Math.ceil(c/O),disableSearchParams:!0,includeButtons:!0,sx:{mt:1}}),e.jsx(k,{sx:{mt:1,mb:-.5}}),e.jsxs(qe,{children:[e.jsx(_,{onClick:j=>{a(S),o(j,"closeClick")},children:"confirm"}),e.jsx(_,{color:"neutral",variant:"outlined",onClick:j=>{y(s),o(j,"escapeKeyDown")},children:"cancel"})]})]})})},It=({image:t,onClick:o,selected:s=!1,tabIndex:a})=>e.jsxs(q,{variant:s?"solid":"outlined",onClick:o,invertedColors:!0,color:s?"primary":"neutral",sx:{width:1,textAlign:"left",transition:"background 150ms","&:hover":{cursor:"pointer",bgcolor:s?"primary.softHoverBg":"neutral.outlinedHoverBg"},border:"1px solid",borderColor:s?"primary.outlinedBorder":"neutral.outlinedBorder"},component:"button",children:[e.jsx(we,{children:e.jsx(ct,{ratio:"2",children:e.jsx("img",{src:t.url,loading:"lazy",alt:t.id})})}),e.jsx(_e,{children:e.jsx(b,{level:"title-md",children:t.id})})]}),Mt=t=>{for(var o="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=s.length,n=0;n<t;n++)o+=s.charAt(Math.floor(Math.random()*a));return o},Dt=({user:t,canEdit:o,isManager:s,refreshUser:a,setRefreshUser:n})=>{const i=he();return t?s?e.jsx(jt,{defaultValue:0,tabListContent:[e.jsx(Q,{value:0,indicatorInset:!0,children:"profile"}),e.jsx(Q,{value:1,indicatorInset:!0,children:"groups"}),e.jsx(Q,{value:2,indicatorInset:!0,children:"permissions"})],children:e.jsxs(H,{children:[e.jsx(Z,{value:0,children:e.jsx(pe,{canEdit:o,user:t,refreshUser:a,setRefreshUser:n})}),e.jsx(Z,{value:1,children:e.jsx("h1",{children:"group stuff"})}),e.jsx(Z,{value:2,children:e.jsx("h1",{children:"permission stuff"})})]})}):e.jsxs(e.Fragment,{children:[e.jsx(k,{}),e.jsx(H,{children:e.jsx(pe,{canEdit:o,user:t,refreshUser:a,setRefreshUser:n})})]}):e.jsx(I,{justifyContent:"center",alignItems:"center",height:"100%",children:e.jsx(H,{children:e.jsxs(Ne,{title:"unknown user :(",color:"warning",code:"ERR_UNKNOWN_ID",children:[e.jsx(b,{level:"body-md",children:"unfortunately i can't find a user with this ID."}),e.jsx(Ze,{startDecorator:e.jsx(vt,{}),onClick:d=>{d.preventDefault(),i(-1)},sx:{mt:1},children:"go back"})]})})})},pe=({user:t,canEdit:o,refreshUser:s,setRefreshUser:a})=>{const[n,i]=r.useState(t?.avatarID),[d,l]=r.useState(t?.name||"unnamed user");return e.jsxs(I,{gap:3,maxWidth:1,width:1,children:[e.jsx(At,{user:t,canEdit:o,name:d,setName:l,avatarID:n,setAvatarID:i,refreshUser:s,setRefreshUser:a}),e.jsx(Pt,{user:t}),e.jsx(k,{}),e.jsx(Tt,{user:t})]})},At=({user:t,canEdit:o,name:s,setName:a,avatarID:n,setAvatarID:i,refreshUser:d,setRefreshUser:l})=>{const[f,u]=r.useState(""),[v,c]=r.useState(!1),[m,p]=r.useState(void 0),[h,x]=r.useState(!1),w=r.useContext(J),g=r.useContext(ze);r.useEffect(()=>{P.image.getURL(n||"").then(C=>{u(C||"")})},[n]);const R=t.id==w?.id,S=()=>{c(!0),P.user.update({id:t.id,name:s,avatarID:n}).then(C=>{R&&g?.(C)}).catch(C=>{p(C)}).finally(()=>{l(!d),c(!1)})},y=()=>o&&(s!=t.name||n!=t.avatarID),O=()=>{a(t.name),i(t.avatarID)},M=v?.7:1;return e.jsxs("form",{onSubmit:C=>{C.preventDefault(),S()},children:[e.jsx(kt,{open:h,image:n||"",setImage:i,onClose:()=>{x(!1)}}),e.jsxs(q,{sx:{width:1,position:"relative",overflow:"hidden"},children:[v&&e.jsx(I,{justifyContent:"center",alignItems:"center",sx:{position:"absolute",width:1,height:1,top:0,left:0,zIndex:999,bgcolor:"background.backdrop",backgroundClip:"padding-box",p:1},children:e.jsx(et,{sx:{width:.8,flexGrow:"inherit"}})}),e.jsxs(D,{sx:{opacity:M},children:[e.jsx(b,{level:"title-md",children:"display info"}),e.jsxs(b,{level:"body-sm",children:[o?"customise":null," how ",R?"you":"the user will"," appear to other atom users."]})]}),e.jsx(k,{sx:{my:1}}),e.jsx(I,{sx:{opacity:M},maxWidth:1,children:e.jsxs(I,{direction:{xs:"column",sm:"row"},maxWidth:1,alignItems:"center",gap:2,children:[e.jsxs(D,{sx:{position:"relative"},children:[e.jsx(ot,{src:f,sx:{width:128,aspectRatio:"1",height:"auto"},children:e.jsx(D,{sx:{scale:128/32},children:t.name.slice(0,1)?.toUpperCase()})}),o&&e.jsx(D,{sx:{position:"absolute",bottom:"1%",right:"1%",bgcolor:"text.primary",padding:.5,display:"flex",justifyContent:"center",alignItems:"center",border:"5px solid",borderColor:"background.surface",borderRadius:"50%",cursor:"pointer","&& > *":{color:"background.body"},"&:hover":{bgcolor:"text.secondary"}},component:"button",type:"button",onClick:()=>{x(!0)},children:e.jsx(gt,{sx:{fontSize:24}})})]}),e.jsxs(U,{children:[e.jsx(z,{children:"display name"}),o?e.jsx(X,{value:s,onChange:C=>{a(C.target.value)},name:"displayName"}):e.jsx(D,{sx:{width:{xs:1,sm:"calc(100% - 16px - 128px)"}},children:e.jsx(b,{level:"body-lg",noWrap:!0,children:s})}),e.jsx(F,{children:"this name is shown to other logged-in users"})]})]})}),m&&e.jsxs(b,{level:"body-sm",color:"danger",children:["couldn't submit display info: ",m]}),o&&e.jsx(k,{sx:{my:1}}),o&&e.jsxs(st,{buttonFlex:"0 1 120px",sx:{justifyContent:"end",opacity:M},children:[e.jsx(_,{variant:"outlined",color:"neutral",disabled:!y(),onClick:O,children:"cancel"}),e.jsx(_,{type:"submit",disabled:!y(),children:"save"})]})]})]})},Pt=({user:t})=>{const s=r.useContext(J)?.id==t.id;return e.jsxs(q,{sx:{width:1,overflow:"hidden"},children:[e.jsxs(D,{children:[e.jsx(b,{level:"title-md",children:"system info"}),e.jsxs(b,{level:"body-sm",children:["check info stored about ",s?"your":"this"," user account."]})]}),e.jsx(k,{}),e.jsx(re,{columns:12,container:!0,spacing:1,children:e.jsx(se,{size:{xs:12,sm:6,lg:4},children:e.jsxs(U,{children:[e.jsx(z,{children:"id"}),e.jsx(X,{value:t.id}),e.jsx(F,{children:"this number is unique to your account. it cannot be changed."})]})})})]})},Tt=({user:t})=>{const s=r.useContext(J)?.id==t.id,[a,n]=r.useState(""),[i,d]=r.useState(!1),[l,f]=r.useState(""),[u,v]=r.useState(!1),[c,m]=r.useState(""),p=he();r.useEffect(()=>{n(Mt(7))},[]);const h=async()=>{v(!0),P.user.delete(t.id).then(x=>{x&&p(-1)}).catch(x=>{m(x)}).finally(()=>{v(!1)})};return e.jsxs(q,{color:"danger",sx:{width:1},children:[e.jsx(ve,{open:i,onClose:()=>{d(!1)},children:u?e.jsx(I,{alignItems:"center",justifyContent:"center",height:1,children:e.jsx(fe,{variant:"outlined",sx:{p:4,height:130,borderRadius:"50%"},children:e.jsx(ie,{size:"lg"})})}):e.jsxs(ge,{maxWidth:400,children:[e.jsx(Ce,{children:"delete account"}),e.jsx(Re,{}),e.jsx(k,{}),e.jsxs(je,{children:[e.jsxs(b,{sx:{mb:1},children:["continuing will ",e.jsx("b",{children:e.jsx("u",{children:"permanently"})})," delete this account."]}),e.jsxs(b,{children:["to confirm you wish to delete this account, please type the following in the box below: ",e.jsx("b",{children:a})]})]}),e.jsx(k,{}),e.jsxs(U,{error:!!c,children:[e.jsx(z,{children:"confirmation code"}),e.jsx(X,{value:l,onChange:x=>{f(x.target.value)}}),c&&e.jsxs(F,{sx:{textTransform:"lowercase"},children:[e.jsx(Ct,{sx:{mr:1}}),"couldn't delete account:"," ",c?.message||c||"unknown issue"]})]}),e.jsx(_,{color:"danger",startDecorator:e.jsx(me,{}),disabled:l!=a,sx:{transition:"background 0.2s, opacity 0.2s, color 0.2s"},onClick:()=>{h()},children:"delete permanently"})]})}),e.jsxs(D,{children:[e.jsx(b,{level:"title-md",children:"danger zone"}),e.jsxs(b,{level:"body-sm",children:["settings that can make large modifications to ",s?"your":"this"," account."]})]}),e.jsx(k,{}),e.jsx(I,{direction:"column",children:e.jsxs(U,{children:[e.jsx(_,{color:"danger",startDecorator:e.jsx(me,{}),fullWidth:!0,onClick:()=>{d(!0)},children:"delete user"}),e.jsx(F,{children:e.jsx(b,{level:"body-xs",children:"this action is permanent and cannot be undone."})})]})})]})};function po({}){return Me("user - atom")}const ho=Ie(function({params:o}){const s=r.useContext(J),[a,n]=r.useState(!1),[i,d]=r.useState(!0),[l,f]=r.useState(!1),[u,v]=r.useState(void 0),[c,m]=r.useState(!0);r.useEffect(()=>{(async()=>v(await P.user.get(o.id)))()},[s,o.id,c]),De({route:[{name:"users",href:"/dashboard/users"},{name:u?.name||"unknown user",href:`/dashboard/users/${encodeURIComponent(o.id)}`}],sidebarActiveTab:Pe.users,title:u?.name||"unknown user"},[u]),r.useEffect(()=>{P.permission.me().then(h=>{h&&(h[B.EditProfile]||h[B.ManageUsers])?(h[B.ManageUsers]&&f(!0),n(!0)):n(!1)}).finally(()=>{d(!1)})});let p=u?.id&&s?.id===u.id;return i?e.jsxs(e.Fragment,{children:[e.jsx(k,{}),e.jsx(H,{children:e.jsx(rt,{width:1,justifyContent:"center",alignItems:"center",children:e.jsx(ie,{})})})]}):e.jsx(Ae,{permissions:p?[]:[B.ManageUsers],children:e.jsx(Dt,{user:u,canEdit:a,isManager:l,refreshUser:c,setRefreshUser:m})})});export{ho as default,po as meta};
