import{a as i,A as R,p as b,o as e,z as C,w as D,y as M}from"./chunk-QMGIS6GS-DtoyICqO.js";import{a as O,A as j}from"./APIManager-B2UZ4w5a.js";import{F as P,V as N,a as _,A as v,W as L,R as k,i as q,G as T,b as B}from"./FormLoadingBox-DGz7rUJZ.js";import{A as F}from"./AuthManager-BTpLP7-g.js";import{F as y,a as S,I as A}from"./FormLabel-C-0_FOk2.js";import{I as V,L as E,C as W}from"./Link-B5kWyCnV.js";import{S as h,B as G,T as p}from"./Stack-JCjNLC7t.js";import{B as w}from"./Button-31T2a4ki.js";import{S as I}from"./Small-BFUFtg_I.js";import{D as z}from"./LinearProgress-BtLiBgIz.js";import{g as K}from"./defaultMeta-DeBRnKiC.js";import"./createSvgIcon-DQe4S7v3.js";import"./buttonClasses-Cy5i3mdA.js";import"./dividerClasses-BlvlTBdT.js";const U=()=>{const[r,l]=i.useState(!1),[c,n]=i.useState(!1),[s,a]=R(),f=b(),d=()=>[c].some(u=>u);return e.jsxs("form",{onSubmit:u=>{u.preventDefault();const m=u.currentTarget.elements;let g={username:m.username.value,password:m.password.value};n(!0),["error","errorMessage","errorCode"].forEach(o=>{s.has(o)&&s.delete(o)}),a(s),F.local.login(g.username,g.password).then(o=>{o?f("/dashboard"):(s.set("error","local"),a(s),n(!1))}).catch(o=>{o instanceof O&&o.status===400?(s.set("error","local"),s.set("errorMessage","invalid username and/or password :("),s.set("errorCode","ERR_LOCAL_INVALID_CREDENTIALS"),a(s)):(s.set("error","local"),a(s)),n(!1)})},style:{position:"relative"},children:[e.jsx(P,{show:d()}),e.jsxs(y,{required:!0,disabled:d(),children:[e.jsx(S,{children:"username"}),e.jsx(A,{type:"text",name:"username",autoComplete:"username"})]}),e.jsxs(y,{required:!0,sx:{mt:-1},disabled:d(),children:[e.jsx(S,{children:"password"}),e.jsx(A,{type:r?"text":"password",name:"password",autoComplete:"current-password",endDecorator:e.jsx(V,{onClick:()=>l(!r),children:r?e.jsx(N,{}):e.jsx(_,{})})})]}),e.jsxs(h,{sx:{gap:3,mt:1},children:[e.jsx(G,{sx:{display:"flex",justifyContent:"end",alignItems:"center"},children:e.jsx(C,{to:"/passwordreset",children:e.jsx(E,{level:"title-sm",component:"div",children:"forgot password?"})})}),e.jsx(w,{type:"submit",fullWidth:!0,disabled:d(),children:"sign in"})]})]})},$=()=>{const[r,l]=i.useState(),[c,n]=i.useState(void 0),[s,a]=i.useState(!0),[f,d]=i.useState(!1),[u,m]=i.useState(!0),g=()=>{j.auth.getLoginTypes().then(t=>{t?.length?l(t):n("noconfigset"),a(!1)}).catch(t=>{n(t),a(!1)}),j.auth.getAccountRegistrationOpen().then(t=>{t&&d(t)}).finally(()=>{m(!1)})},o=()=>{l(void 0),n(void 0),a(!0),d(!1),m(!0)};return i.useEffect(()=>{g()},[]),[s,u].some(t=>t)?e.jsx(h,{direction:"row",justifyContent:"center",children:e.jsx(W,{variant:"soft"})}):c?e.jsxs(h,{direction:"column",gap:4,children:[e.jsxs("div",{children:[e.jsx(v,{startDecorator:e.jsx(L,{}),variant:"outlined",color:"danger",children:e.jsxs("div",{children:["can't load login configuration",e.jsx(p,{level:"body-sm",component:"div",children:"i can't seem to load the login settings. please check your internet connection, or contact the owner of this instance of atom."})]})}),e.jsx(I,{sx:{mt:1},children:"ERR_NO_SERVER_LOGIN_CONFIGS"})]}),e.jsx(w,{size:"sm",color:"primary",startDecorator:e.jsx(k,{}),onClick:()=>{o(),g()},children:"retry"})]}):e.jsxs(h,{sx:{gap:4},children:[e.jsxs(h,{sx:{gap:1},children:[e.jsx(p,{component:"h1",level:"h3",children:"sign in"}),f?e.jsxs(p,{level:"body-sm",component:"div",children:["don't have an account?"," ",e.jsx(C,{to:"/signup",children:e.jsx(E,{component:"div",children:"request one here!"})})]}):null]}),q([...new Set(r)].map(t=>{switch(t){case"google":return e.jsx(x,{method:t,children:e.jsx(w,{variant:"soft",color:"neutral",fullWidth:!0,startDecorator:e.jsx(T,{}),onClick:()=>{document.location.href="/auth/login/google"},children:"login with google"},t)});case"local":return e.jsx(x,{method:t,children:e.jsx(U,{},t)});default:return e.jsx(x,{method:t,children:e.jsxs(v,{startDecorator:e.jsx(L,{}),color:"warning",variant:"outlined",children:["unsupported authentication method: ",t]},t)})}}),e.jsx(z,{children:"or"}))]})},x=({method:r,children:l})=>{const[c,n]=R();return e.jsxs(h,{gap:1,children:[l,c.get("error")==r?e.jsx(v,{startDecorator:e.jsx(B,{}),sx:{alignItems:"flex-start"},variant:"soft",color:"danger",children:e.jsxs("div",{children:[e.jsx("div",{children:"couldn't log in"}),e.jsx(p,{level:"body-sm",color:"danger",textTransform:"lowercase",children:c.get("errorMessage")||"something happened and i couldn't log you in"}),e.jsx(I,{textTransform:"uppercase",children:c.get("errorCode")||"ERR_UNKNOWN"})]})}):null]})};function ce({}){return K("log in - atom")}async function de(){return await j.auth.loggedIn()?M("/dashboard"):{}}const ue=D(function({loaderData:l}){return e.jsx($,{})});export{de as clientLoader,ue as default,ce as meta};
