import{a as d,A as C,p as A,o as e,z as P,w as D,y as _}from"./chunk-QMGIS6GS-DtoyICqO.js";import{a as b,A as I}from"./APIManager-B2UZ4w5a.js";import{E as M}from"./ErrorCard-KNXIau_K.js";import{F as N,V as T,a as F,R as k,i as O,A as R,W as V,G as H,b as W}from"./FormLoadingBox-DGz7rUJZ.js";import{A as u}from"./AuthManager-BTpLP7-g.js";import{v as x}from"./index-D9GkzZBy.js";import{F as S,a as v,I as y}from"./FormLabel-C-0_FOk2.js";import{F as E,f as L}from"./FormHelperText-zgYa2BNp.js";import{I as G,C as U,L as B}from"./Link-B5kWyCnV.js";import{B as w}from"./Button-31T2a4ki.js";import{S as $}from"./Small-BFUFtg_I.js";import{S as h,T as g}from"./Stack-JCjNLC7t.js";import{D as q}from"./LinearProgress-BtLiBgIz.js";import{g as z}from"./defaultMeta-DeBRnKiC.js";import"./createSvgIcon-DQe4S7v3.js";import"./buttonClasses-Cy5i3mdA.js";import"./dividerClasses-BlvlTBdT.js";const K=()=>{const[t,l]=d.useState(!1),[i,o]=d.useState(!1),[r,a]=C(),p=A(),f=()=>[i].some(m=>m);return e.jsxs("form",{onSubmit:m=>{m.preventDefault();const s=m.currentTarget.elements,c={username:s.username.value,password:s.password.value};if(o(!0),["error","errorMessage","errorCode"].forEach(n=>{r.has(n)&&r.delete(n)}),a(r),c.username=x.trim(c.username),!x.matches(c.username,u.local.usernamePattern)){r.set("error","local"),r.set("errorMessage","invalid username - please only between 3 and 16 alphanumeric and the following characters: ._-"),r.set("errorCode","ERR_INVALID_USERNAME"),a(r),o(!1);return}if(!x.matches(c.password,u.local.passwordPattern)){r.set("error","local"),r.set("errorMessage",'invalid password - please only use between 12 and 255 alphanumeric and the following characters: ._+-/\\*=!"Â£$ %^&*()[]{}:;@#~&<>?'),r.set("errorCode","ERR_INVALID_PASSWORD"),a(r),o(!1);return}u.local.signup(c.username,c.password).then(n=>{n&&p("/dashboard")}).catch(n=>{n instanceof b&&n.status==400?(r.set("error","local"),r.set("errorMessage",n.response?.data?.message||"invalid username and/or password. "),r.set("errorCode",n.response?.data?.errorCode||"ERR_LOCAL_INVALID_SIGNUP_CREDENTIALS"),a(r)):(r.set("error","local"),a(r))}).finally(()=>{o(!1)})},style:{position:"relative"},children:[e.jsx(N,{show:f()}),e.jsxs(S,{required:!0,sx:{":focus-within":{[`& .${L.root}`]:{maxHeight:"100px",mt:1}}},children:[e.jsx(v,{children:"username"}),e.jsx(y,{type:"text",name:"username",autoComplete:"username"}),e.jsxs(E,{sx:{maxHeight:0,transition:"all 0.1s",overflow:"hidden",mt:0},children:["must match: ",u.local.usernamePattern.toString()]})]}),e.jsxs(S,{required:!0,sx:{mt:-1,":focus-within":{[`& .${L.root}`]:{maxHeight:"100px",mt:1}}},children:[e.jsx(v,{children:"password"}),e.jsx(y,{type:t?"text":"password",name:"password",autoComplete:"new-password",endDecorator:e.jsx(G,{onClick:()=>l(!t),children:t?e.jsx(T,{}):e.jsx(F,{})})}),e.jsxs(E,{sx:{maxHeight:0,transition:"all 0.1s",overflow:"hidden",mt:0},children:["must match: ",e.jsx("br",{})," ",u.local.passwordPattern.toString()]})]}),e.jsx(w,{type:"submit",fullWidth:!0,sx:{mt:2},children:"sign up"})]})},J=()=>{const[t,l]=d.useState(),[i,o]=d.useState(void 0),[r,a]=d.useState(!0),p=()=>{I.auth.getSignupTypes().then(s=>{s?.length?l(s):o("ERR_NO_SERVER_LOGIN_CONFIGS"),a(!1)}).catch(s=>{o(s),a(!1)})},f=()=>{l(void 0),o(void 0),a(!0)};return d.useEffect(()=>{p()},[]),[r].some(s=>s)?e.jsx(h,{direction:"row",justifyContent:"center",children:e.jsx(U,{variant:"soft"})}):i?e.jsxs(h,{gap:4,children:[e.jsx(M,{code:i,children:e.jsx(g,{level:"body-md",children:"either i can't load the authentication methods, or there are none set up. please check your connection, then contact the owner of this instance of atom."})}),e.jsx(w,{size:"sm",color:"primary",startDecorator:e.jsx(k,{}),onClick:()=>{f(),p()},children:"retry"})]}):e.jsxs(h,{gap:4,children:[e.jsxs(h,{gap:1,children:[e.jsx(g,{component:"h1",level:"h3",children:"sign up"}),e.jsxs(g,{level:"body-sm",component:"div",children:["already have an account?"," ",e.jsx(P,{to:"/login",children:e.jsx(B,{component:"div",children:"login here!"})})]})]}),O([...new Set(t)].map(s=>{switch(s){case"google":return e.jsx(j,{method:s,children:e.jsx(w,{variant:"soft",color:"neutral",fullWidth:!0,startDecorator:e.jsx(H,{}),onClick:()=>{document.location.href="/auth/signup/google"},children:"sign up with google"},s)});case"local":return e.jsx(j,{method:s,children:e.jsx(K,{})});default:return e.jsx(j,{method:s,children:e.jsxs(R,{startDecorator:e.jsx(V,{}),color:"warning",variant:"outlined",children:["unsupported authentication method: ",s]},s)})}}),e.jsx(q,{children:"or"}))]})},j=({method:t,children:l})=>{const[i,o]=C();return e.jsxs(h,{gap:1,children:[l,i.get("error")==t?e.jsx(R,{startDecorator:e.jsx(W,{}),sx:{alignItems:"flex-start"},variant:"soft",color:"danger",children:e.jsxs("div",{children:[e.jsx("div",{children:"couldn't sign up"}),e.jsx(g,{level:"body-sm",color:"danger",textTransform:"lowercase",children:i.get("errorMessage")||"something happened and i couldn't sign you up"}),e.jsx($,{textTransform:"uppercase",children:i.get("errorCode")||"ERR_UNKNOWN"})]})}):null]})};function he({}){return z("sign up - atom")}async function pe(){return await I.auth.loggedIn()?_("/dashboard"):{}}const ge=D(function({loaderData:l}){return e.jsx(J,{})});export{pe as clientLoader,ge as default,he as meta};
